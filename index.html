<!DOCTYPE html>
<html>
    <head>
    <title>Old-World-Atlas</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv='imagetoolbar' content='no'/>
    <style type="text/css"> v\:* {behavior:url(#default#VML);}
        html, body { overflow: hidden; padding: 0; height: 100%; width: 100%; font-family: 'Lucida Grande',Geneva,Arial,Verdana,sans-serif; }
        body { margin: 0; background: #fff; }
        h1 { margin: 0; padding: 6px; border:0; font-size: 20pt; position: absolute; top: 10px; right: 10px; background: rgba(255, 255, 255, 0.8); z-index: 10; text-align: right; }
        #header { display: none; }
        #subheader { display: none; }
        #map { height: 100%; border: none; }
        #mouse-position { position: absolute; bottom: 10px; right: 10px; background: rgba(255, 255, 255, 0.8); padding: 5px; z-index: 10; font-size: 12px; }
        .title-subheader { margin: 0; padding: 0; font-size: 10px; color: #666; font-weight: normal; }
        .settlement-label { font-size: 12px; font-weight: bold; background: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px; }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.js"></script>
    <script src="https://unpkg.com/ol-layerswitcher@4.1.1"></script>
    <link rel="stylesheet" href="https://unpkg.com/ol-layerswitcher@4.1.1/src/ol-layerswitcher.css" />
</head>
<body>
    <div id="header"><h1>Old-World-Atlas</h1></div>
    <div id="map" class="map"></div>
    <div style="position: absolute; top: 10px; right: 30px; z-index: 10;">
        <h1>Atlas of the Old World</h1>
        <p class="title-subheader">Alpha. @toddkoz</p>
    </div>
    <div id="mouse-position"></div>
    <script type="text/javascript">
        var mousePositionControl = new ol.control.MousePosition({
            className: 'custom-mouse-position',
            target: document.getElementById('mouse-position'),
            undefinedHTML: '&nbsp;'
        });
        
        // Load settlements GeoJSON
        var settlementSource = new ol.source.Vector({
            url: 'data/settlements.geojson',
            format: new ol.format.GeoJSON(),
            loader: function(extent, resolution, projection, success, failure) {
                var url = 'data/settlements.geojson';
                fetch(url)
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(json) {
                        var features = new ol.format.GeoJSON().readFeatures(json);
                        settlementSource.addFeatures(features);
                        success(features);
                    })
                    .catch(function(e) {
                        console.error('Error loading settlements:', e);
                        failure();
                    });
            }
        });
        
        var map = new ol.Map({
            controls: ol.control.defaults.defaults().extend([mousePositionControl]),
            target: 'map',

            layers: [
                new ol.layer.Group({
                    title: 'Overlay',
                    layers: [
                        new ol.layer.Tile({
                            title: 'Map Tiles',
                            // opacity: 0.7,
                            source: new ol.source.TileImage({
                                attributions: '',
                                tileGrid: new ol.tilegrid.TileGrid({
                                    extent: [-4.7926911472531506,40.3006238607187441,13.7306637823468485,58.8239787903187477],
                                    origin: [-4.7926911472531506,40.3006238607187441],
                                    resolutions: [0.0740934197183999999,0.0370467098591999999,0.0185233549296,0.00926167746479999998,0.00463083873239999999,0.0023154193662,0.0011577096831,0.000578854841549999999],
                                    tileSize: [256, 256]
                                }),
                                tileUrlFunction: function(tileCoord) {
                                    return ('https://raw.githubusercontent.com/dr-laser/oldworldatlas-repository/main/{z}/{x}/{y}.png'
                                        .replace('{z}', String(tileCoord[0]))
                                        .replace('{x}', String(tileCoord[1]))
                                        .replace('{y}', String(- 1 - tileCoord[2])));
                                },
                            })
                        }),
                    ]
                }),
                new ol.layer.Vector({
                    title: 'Settlements',
                    source: settlementSource,
                    style: function(feature) {
                        return new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: 6,
                                fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.8)' }),
                                stroke: new ol.style.Stroke({ color: 'rgba(0, 0, 0, 0.8)', width: 2 })
                            }),
                            text: new ol.style.Text({
                                text: feature.get('name'),
                                offsetY: 12,
                                fill: new ol.style.Fill({ color: '#000' }),
                                stroke: new ol.style.Stroke({ color: '#fff', width: 2 })
                            })
                        });
                    }
                })
            ],
            view: new ol.View({
                center: [3.832390, 49.796453],
                resolution: 0.0159930693920000006,
                maxResolution: 0.0370467098591999999,
                minResolution: 0.000578854841549999999
            })
        });
    </script>
</body>
</html>